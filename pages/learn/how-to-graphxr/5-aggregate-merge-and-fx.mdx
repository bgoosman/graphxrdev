| In this Session... | Before you begin... |
| --- | --- |
| *   Using Transforms:<br/>    <br/>    *   _**f(x)**_ and _**Link**_ to reformat and reorganize data.<br/>        <br/>    *   _**Aggregate**_ to enumerate and/or evaluate nodes or edges.<br/>        <br/>    *   _**Merge**_ to merge nodes or edges. | To follow along, download the files:<br/><br/>[HowTo\_05\_START.graphxr](/HowTo_05_START.graphxr)<br/><br/>and [https://kineviz.com/s/GXR\_QSG.zip](https://kineviz.com/s/GXR_QSG.zip) |

<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vQU2DP3zXM_vjn_1RhX2ASYA3M_Sq92zGxGZk2RiTP4_mWghE94uv_FSLIixNuglMwE7LOv7xmSi_rR/embed?start=false&loop=false&delayms=60000" frameborder="0" width="768" height="569" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

| **Slide** |     |
| --- | --- |
| 1   | How To GraphXR 5. Aggregate and Merge |
| 2   | Before You Begin...<br/><br/>Ideally, you'll have worked through _Module 4. Link and Filter_. If you're starting here, and you want to follow along, you'll need to:<br/><br/>*   Log in to GraphXR, create a Project, and open its graph space. , Download the file [https://kineviz.com/s/GXR\_QSG.zip](https://kineviz.com/s/GXR_QSG.zip)**,** which contains the Game of Thrones data we'll use in our tutorials., Drag and drop the file 05\_START.graphxr onto the space. |
| 3   | So far, we've extracted a House category from the _Characters.csv_ data, created a BELONGS\_TO relationship with Character nodes, and a SPOKE relationship between Characters and the Lines they spoke. |
| 4   | Now we want to link lines of dialog with the broadcast Episodes they were spoken on.  <br/>We can do this using _**Merge**_ and _**Aggregate**_ transforms. Drag and drop _Episodes.csv_ onto the graph space, creating the new Episodes category and properties. |
| 5   | The _Episodes.csv_ file contains the titles, descriptions, air dates, episode numbers, seasonnumbers, and viewership for each broadcast episode. We can now connect lines of dialog to corresponding episodes. |
| 6   | We have a little problem, though. In Lines, season and episode number are combined into the single string _seasonEpisode_. In Episodes, they occupy separate properties. |
| 7   | To fix this, we'll use the **Transform** panel and **f(x)** tab. It lets us run javascript formulas on properties of a category or relationship. Presets are included, but for this we'll need to entera custom formula. Select Episodes and _episodeNumber_. |
| 8   | Enter _seasonEpisode_ as the new property name, and enter the custom formula :<br/><br/>(propVal,props) => 'S'+props.seasonNumber+'E'+props.episodeNumber<br/><br/>An example result is automatically displayed under the **New Property Name**. |
| 9   | Click **Run**. You can scroll to the bottom of the panel to view the results. |
| 10  | Now that the property values match, we can go to the _**Link**_ transform. In both Episodes and Lines, select the _seasonEpisode_ property, and click _**Run**_ to link nodes with matching properties via edges of a new SPOKEN\_ON relationship. |
| 11  | As we explore patterns in more detail, we can use _**Aggregate**_ to add new properties to the graph and _**Merge**_ to simplify and clarify the graph. |
| 12  | We want to add a _totalLines_ property-the total number of lines spoken-to each Episode node. Lines nodes do have a _lineCount_ property for each speaker and episode. We can use the _**Aggregate**_ transform to sum those values and write the total to connected Episode nodes. |
| 13  | Go to the _**Transform**_ panel and _**Aggregate**_ tab (take a Snapshot first!).  <br/>Under _**Aggregate to Category**_, select Episodes.  <br/>Under _**Aggregate Along**_ select SPOKEN\_ON.  <br/>Click _**Property from Neighbor Nodes**_ and select _lineCount_.   <br/>For the _New Property_ enter _totalLines_, select the sum preset, and click _**Run**_. |
| 14  | We can also use _**Aggregate**_ to return the number of unique characters per Episode.  <br/>Select the Episodes category and SPOKEN\_ON relationship.  <br/>Click _**Property from Neighbor Nodes**_, and select the _speaker_ property.  <br/>Under _**New Property**_ enter _totalCharacters,_ under _**Formula Name**_ select _count_, and click _**Run**_. |
| 15  | Now display a table to see the new _totalLines_ and _totalCharacters_ properties.  <br/>And before we move on, create another Snapshot.  <br/>Note that at any time, you can download your snapshots as a single .ZIP archive. |
| 16  | Now let's simplify the graph using _**Merge**_. It combines nodes of a single category or the edges of a single relationship based on a property value.  <br/>Go to the _**Transform**_ panel and _**Merge**_ tab. |
| 17  | With _**Merge**_ we can use the _seasonEpisode_ property to merge Lines nodes for an episode into a single node.  <br/>Click _**Category**_ and select Lines, and select _seasonEpisode_ as the property.  <br/>Click _**Clear Unselected Properties**_ since only the _seasonEpisode_ property is meaningful. |
| 18  | To simplify the graph we'll use **Merge** to combine the lines nodes for an episode into a single node, using the _seasonEpisode_ property.  <br/>Click **Category** and select Lines, and select _seasonEpisode_ as the key property. Click **Clear Unselected Properties** since only the _seasonEpisode_ property will be meaningful. |
| 19  | Now click **Run**. With only one Lines node per Episode, we can now visualize the content of Episodes more clearly.   <br/>But we can simplify the graph even further. In _Module 6. Shortcut_, we'll return to the Snapshot we created before merging to see how. |